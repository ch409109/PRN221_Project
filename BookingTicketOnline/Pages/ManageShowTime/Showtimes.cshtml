@page "{weekOffset:int?}"
@model BookingTicketOnline.Pages.ManageShowTime.ShowtimesModel
@{
	ViewData["Title"] = "Weekly Showtime Scheduler";
	var startOfWeek = Model.StartOfWeek;
	int weekOffset = RouteData.Values["weekOffset"] != null ? int.Parse(RouteData.Values["weekOffset"].ToString()) : 0;
	int? isEdittingValue = HttpContext.Session.GetInt32("isEditting");
	bool isEditting = isEdittingValue.HasValue && isEdittingValue.Value == 1;
}

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>@ViewData["Title"]</title>
	<link href="~/css/Showtime.css" rel="stylesheet" />
</head>
<body>

	<div class="scheduler">
		<div class="header">Weekly Showtime Scheduler</div>

		<!-- Button to go back to Index -->
		<div class="button-container">
			<a asp-page="./Index">
				<button>⬅ Select Room</button>
			</a>
		</div>

		<div class="button-container">
			<a asp-page="./Showtimes" asp-route-weekOffset="@(weekOffset - 1)">
				<button>&#9664; Previous Week</button>
			</a>
			<span>@startOfWeek.ToString("MMM d") - @startOfWeek.AddDays(6).ToString("MMM d, yyyy")</span>
			<a asp-page="./Showtimes" asp-route-weekOffset="@(weekOffset + 1)">
				<button>Next Week &#9654;</button>
			</a>
		</div>

		<div class="scheduler-content">
			<!-- Table container for schedule -->
			<div class="table-container">
				<!-- Header row with days -->
				<div></div>
				@for (int i = 0; i < 7; i++)
				{
					<div class="day-header">@startOfWeek.AddDays(i).ToString("ddd") <br /> @startOfWeek.AddDays(i).ToString("MM/dd")</div>
				}

				<!-- Time slots and events -->
				@for (int hour = 0; hour < 24; hour++)
				{
					<div class="time-slot">@hour:00</div>
					@for (int day = 0; day < 7; day++)
					{
						var currentDay = startOfWeek.AddDays(day);
						var showtime = Model.Showtimes.FirstOrDefault(s => s.Date == currentDay.Date && s.StartTime?.Hours == hour);

						if (showtime != null)
						{
							<a asp-page-handler="SelectShowtime" asp-route-id="@showtime.Id" asp-route-weekOffset="@weekOffset">
								<div class="event">
									@showtime.Movie?.Title
									<br />
									@showtime.StartTime?.ToString(@"hh\:mm") - @showtime.EndTime?.ToString(@"hh\:mm")
								</div>
							</a>
						}
						else
						{
							<div></div>
						}
					}
				}
			</div>

			<!-- Add/Edit Showtime Form -->
			<div class="showtime-form">
				<h3>Add/Edit Showtime</h3>
				<form method="post" asp-page-handler="SaveShowtime">
					<input type="hidden" id="showtimeId" value="@Model.Showtime.Id" />
					<label for="movie">Movie:</label>
					<select asp-for="Showtime.MovieId">
						@foreach (var movie in Model.Movies)
						{
							<option value="@movie.Id">@movie.Title</option>
						}
					</select>

					<label for="room">Room:</label>
					<input asp-for="@Model.room.Name" readonly />

					<label for="date">Date:</label>
					@if (isEditting)
					{
						<input asp-for="@Model.Showtime.Date" value="@Model.Showtime.Date" type="datetime" readonly />
					}
					else
					{
						<input asp-for="@Model.Showtime.Date" value="@Model.Showtime.Date" type="date" />
					}

					<label for="startTime">Start Time:</label>
					<input asp-for="@Model.Showtime.StartTime" value="@Model.Showtime.StartTime" type="time" />

					<label for="endTime">End Time:</label>
					<input asp-for="@Model.Showtime.EndTime" value="@Model.Showtime.EndTime" readonly type="time" />

					@if (!isEditting)
					{
						<div class="auto-render-container">
							<input onclick="alert('This action will automatically generate showtimes for that day!')" type="checkbox" asp-for="@Model.isAutoRendered" class="auto-render-checkbox" />
							<label for="isAutoRendered" class="auto-render-label">Auto Generate Showtime?</label>
						</div>
					}

					<button type="submit">Save</button>
					<a class="btn btn-outline-danger" asp-page-handler="Cancel">Cancel</a>
				</form>
			</div>
		</div>
	</div>
	<!-- JavaScript to clear the form -->
	<script>
		function clearForm() {
			document.querySelector("form").reset();
			const checkbox = document.querySelector("input[type='checkbox']");
			checkbox.checked = false;
		}
	</script>
</body>
</html>
